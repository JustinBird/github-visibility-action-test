name: Visibility Test
description: A test that the action makes the repo public and private

on:
  schedule:
    - cron: '0 7 * * *'  # Every day at 07:00 UTC
  push:
  workflow_dispatch:

jobs:
  run-my-action:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Make the repo private
        uses: justinbird/github-visibility-action@main
        with:
          token: '${{ secrets.ADMINISTRATION_TOKEN }}'
          visibility: 'private'

      - name: Sleep for 10 seconds
        run: sleep 10s
        shell: bash

      - name: Check that the repo is private
        shell: bash
        run: >
          curl -L
          -H "Accept: application/vnd.github+json"
          -H "Authorization: Bearer ${{ secrets.ADMINISTRATION_TOKEN }}"
          -H "X-GitHub-Api-Version: 2022-11-28"
          https://api.github.com/repos/${{ github.repository }} |
          jq '.visibility' |
          grep "private"

      - name: Make the repo public
        uses: justinbird/github-visibility-action@main
        with:
          token: '${{ secrets.ADMINISTRATION_TOKEN }}'
          visibility: 'public'

      - name: Sleep for 10 seconds
        run: sleep 10s
        shell: bash

      - name: Check that the repo is public
        shell: bash
        run: >
          curl -L
          -H "Accept: application/vnd.github+json"
          -H "Authorization: Bearer ${{ secrets.ADMINISTRATION_TOKEN }}"
          -H "X-GitHub-Api-Version: 2022-11-28"
          https://api.github.com/repos/${{ github.repository }} |
          jq '.visibility' |
          grep "public"